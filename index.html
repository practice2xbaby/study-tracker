<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Study Time Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button { margin: 5px; padding: 8px; font-size: 16px; }
        canvas { 
            width: 800px !important; /* Adjust width */
            height: 400px !important; /* Adjust height */
            max-width: 50%;
            margin: 20px auto;
            display: block; 
        }
        .stats { margin-top: 20px; font-size: 18px; }
    </style>
</head>
<body>

    <h2>Monthly Study Time Tracker</h2>

    <label for="date">Date:</label>
    <input type="date" id="date">
    
    <label for="minutes">Minutes:</label>
    <input type="number" id="minutes" placeholder="Enter minutes">

    <button onclick="addOrUpdateData()">Add/Update Data</button>
    <button onclick="clearData()" style="background: red; color: white;">Clear Data</button>

    <canvas id="studyChart"></canvas>

    <div class="stats">
        <p><strong>Weekly Total Hours:</strong> <span id="weeklyTotal">0</span> hrs</p>
        <p><strong>Weekly Average Hours:</strong> <span id="weeklyAvg">0</span> hrs</p>
        <p><strong>Monthly Average Hours:</strong> <span id="monthlyAvg">0</span> hrs</p>
    </div>

    <script>
        const ctx = document.getElementById('studyChart').getContext('2d');

        // Load saved data from LocalStorage
        let studyData = JSON.parse(localStorage.getItem('studyData')) || { labels: [], data: [] };

        // Create the chart
        const studyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: studyData.labels,
                datasets: [{
                    label: 'Minutes Spent Studying',
                    data: studyData.data,
                    backgroundColor: 'rgba(255, 182, 193, 0.6)',  // Baby pink (light)
                    borderColor: 'rgba(255, 182, 193, 1)',        // Baby pink (solid)
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        function addOrUpdateData() {
            const dateInput = document.getElementById('date').value;
            const minutes = document.getElementById('minutes').value;

            if (!dateInput || !minutes) {
                alert("Please enter both date and minutes!");
                return;
            }

            // Convert YYYY-MM-DD to MM-DD-YYYY
            const dateObj = new Date(dateInput);
            const formattedDate = `${String(dateObj.getMonth() + 1).padStart(2, '0')}-${String(dateObj.getDate()).padStart(2, '0')}-${dateObj.getFullYear()}`;

            // Check if it's the first day of a new month
            if (dateObj.getDate() === 1) {
                resetData();
            }

            const existingIndex = studyData.labels.indexOf(formattedDate);

            if (existingIndex !== -1) {
                // Update existing data
                studyData.data[existingIndex] = Number(minutes);
            } else {
                // Add new data
                studyData.labels.push(formattedDate);
                studyData.data.push(Number(minutes));
            }

            localStorage.setItem('studyData', JSON.stringify(studyData)); // Save to LocalStorage

            studyChart.data.labels = studyData.labels;
            studyChart.data.datasets[0].data = studyData.data;
            studyChart.update();

            updateStatistics();

            // Clear input fields
            document.getElementById('date').value = '';
            document.getElementById('minutes').value = '';
        }

        function resetData() {
            alert("New month detected! Resetting all data.");
            localStorage.removeItem('studyData'); // Clear LocalStorage
            studyData = { labels: [], data: [] }; // Reset data
            studyChart.data.labels = [];
            studyChart.data.datasets[0].data = [];
            studyChart.update();
            updateStatistics();
        }

        function clearData() {
            if (confirm("Are you sure you want to clear all data?")) {
                localStorage.removeItem('studyData'); // Clear LocalStorage
                studyData = { labels: [], data: [] }; // Reset data
                studyChart.data.labels = [];
                studyChart.data.datasets[0].data = [];
                studyChart.update();
                updateStatistics();
            }
        }

        function updateStatistics() {
            let weeklyTotals = {};
            let monthlyTotals = {};
            let totalMinutesThisMonth = 0;
        
            let now = new Date(); // Get current date
            let currentYear = now.getFullYear();
            let currentMonth = now.getMonth(); // 0-indexed (0 = January, 11 = December)
        
            studyData.labels.forEach((date, index) => {
                let [month, day, year] = date.split('-').map(Number);
                let fullDate = new Date(year, month - 1, day);
                let weekStart = new Date(fullDate);
                weekStart.setDate(fullDate.getDate() - fullDate.getDay()); // Get start of the week (Sunday)
        
                let weekKey = `${weekStart.getFullYear()}-${String(weekStart.getMonth() + 1).padStart(2, '0')}-${String(weekStart.getDate()).padStart(2, '0')}`;
                let monthKey = `${year}-${String(month).padStart(2, '0')}`;
        
                weeklyTotals[weekKey] = (weeklyTotals[weekKey] || 0) + studyData.data[index];
                monthlyTotals[monthKey] = (monthlyTotals[monthKey] || 0) + studyData.data[index];
        
                // Track total minutes for the current month
                if (year === currentYear && month - 1 === currentMonth) {
                    totalMinutesThisMonth += studyData.data[index];
                }
            });
        
            // Calculate weekly total and average
            let lastWeek = Object.keys(weeklyTotals).sort().pop();
            let weeklyTotal = weeklyTotals[lastWeek] || 0;
            let weeklyAvg = (weeklyTotal / 7) / 60; // Convert minutes to hours
        
            // Calculate monthly average
            let daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            let monthlyAvg = totalMinutesThisMonth / 60 / daysInMonth;
        
            // Update UI
            document.getElementById('weeklyTotal').textContent = (weeklyTotal / 60).toFixed(2); // Convert minutes to hours
            document.getElementById('weeklyAvg').textContent = weeklyAvg.toFixed(2);
            document.getElementById('monthlyAvg').textContent = monthlyAvg.toFixed(2);
        }

        // Initialize statistics on page load
        updateStatistics();
    </script>

</body>
</html>
