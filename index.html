<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Timer Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            padding: 20px; 
        }
        input, button { 
            margin: 5px;
            padding: 8px;
            font-size: 16px; 
        }
        canvas { 
            width: 800px !important;
            height: 400px !important;
            max-width: 50%;
            margin: 20px auto;
            display: block;
        }
        .stats, .timer-section { margin-top: 20px; font-size: 18px; }
    </style>
</head>
<body>
    <h2>Study Time Tracker</h2>

    <label for="date">Date:</label>
    <input type="date" id="date">
    
    <label for="minutes">Minutes:</label>
    <input type="number" id="minutes" placeholder="Enter minutes">

    <button onclick="addOrUpdateData()">Add/Update Data</button>
    <button onclick="clearData()" style="background: red; color: white;">Clear Data</button>
    
    <div class="timer-section">
        <h3>Study Timer</h3>
        <input type="number" id="timerHours" min="0" max="24" placeholder="Hours">
        <input type="number" id="timerMinutes" min="0" max="59" placeholder="Minutes">
        <input type="number" id="timerSeconds" min="0" max="59" placeholder="Seconds">
        <button onclick="startTimer()">Start Timer</button>
        <button onclick="stopTimer()">Stop Timer</button>
        <p id="timerDisplay">00:00:00</p>
    </div>

    <canvas id="studyChart"></canvas>

    <div class="stats">
        <p><strong>Weekly Total Hours:</strong> <span id="weeklyTotal">0</span> hrs</p>
        <p><strong>Weekly Average Hours:</strong> <span id="weeklyAvg">0</span> hrs</p>
        <p><strong>Average Hours per Day:</strong> <span id="monthlyAvg">0</span> hrs</p>
    </div>

    <script>
        let timerInterval, startTime;
        let elapsedSeconds = 0;
        const ctx = document.getElementById('studyChart').getContext('2d');
        let studyData = JSON.parse(localStorage.getItem('studyData')) || { labels: [], data: [] };

        const studyChart = new Chart(ctx, {
            type: 'bar',
            data: { labels: studyData.labels, datasets: [{
                label: 'Minutes Spent Studying',
                data: studyData.data,
                backgroundColor: 'rgba(255, 182, 193, 0.6)',
                borderColor: 'rgba(255, 182, 193, 1)',
                borderWidth: 1
            }] },
            options: { scales: { y: { beginAtZero: true } } }
        });

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            const hours = parseInt(document.getElementById('timerHours').value) || 0;
            const minutes = parseInt(document.getElementById('timerMinutes').value) || 0;
            const seconds = parseInt(document.getElementById('timerSeconds').value) || 0;
            elapsedSeconds = (hours * 3600) + (minutes * 60) + seconds;
            if (elapsedSeconds <= 0) { alert("Set a valid timer!"); return; }
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            let now = Date.now();
            let timePassed = Math.floor((now - startTime) / 1000);
            let remaining = elapsedSeconds - timePassed;
            if (remaining <= 0) {
                clearInterval(timerInterval);
                document.getElementById('timerDisplay').textContent = "00:00:00";
                addStudyTime(elapsedSeconds / 60);
                return;
            }
            let hrs = Math.floor(remaining / 3600);
            let mins = Math.floor((remaining % 3600) / 60);
            let secs = remaining % 60;
            document.getElementById('timerDisplay').textContent = `${String(hrs).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function stopTimer() {
            if (!timerInterval) return;
            clearInterval(timerInterval);
            let totalElapsed = Math.floor((Date.now() - startTime) / 1000) / 60;
            addStudyTime(totalElapsed);
        }

        function addStudyTime(minutes) {
            let today = new Date();
            let formattedDate = `${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}-${today.getFullYear()}`;
            const existingIndex = studyData.labels.indexOf(formattedDate);
            if (existingIndex !== -1) studyData.data[existingIndex] += minutes;
            else { studyData.labels.push(formattedDate); studyData.data.push(minutes); }
            localStorage.setItem('studyData', JSON.stringify(studyData));
            studyChart.data.labels = studyData.labels;
            studyChart.data.datasets[0].data = studyData.data;
            studyChart.update();
            updateStatistics();
        }

        function updateStatistics() {
            let totalMinutes = studyData.data.reduce((a, b) => a + b, 0);
            let weeklyTotal = totalMinutes / 60;
            let daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            let monthlyAvg = (totalMinutes / daysInMonth) / 60;
            document.getElementById('weeklyTotal').textContent = weeklyTotal.toFixed(2);
            document.getElementById('weeklyAvg').textContent = (weeklyTotal / 7).toFixed(2);
            document.getElementById('monthlyAvg').textContent = monthlyAvg.toFixed(2);
        }

        function clearData() {
            if (confirm("Are you sure you want to clear all data?")) {
                localStorage.removeItem('studyData');
                studyData = { labels: [], data: [] };
                studyChart.data.labels = [];
                studyChart.data.datasets[0].data = [];
                studyChart.update();
                updateStatistics();
            }
        }
    </script>
</body>
</html>
